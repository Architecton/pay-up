!function(){function e(t,o){var r=function(e){return decodeURIComponent(Array.prototype.map.call(t.atob(e),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))},n=function(n){return new Promise(function(e){t.localStorage["payup-token"]=n,e(!0)})},u=function(){return t.localStorage["payup-token"]},a=function(){t.localStorage.removeItem("payup-token"),document.documentElement.style.backgroundColor="lightgrey",document.body.style.backgroundColor="lightgrey"},i=function(){var e=u();return!!e&&JSON.parse(r(e.split(".")[1])).expirationDate>Date.now()/1e3},c=function(){if(i()){var e=u(),n=JSON.parse(r(e.split(".")[1]));return{username:n.username,name:n.name,surname:n.surname,email:n.email,nightmode:n.nightmode,defaultCurrency:n.defaultCurrency}}};return{saveToken:n,getToken:u,signUp:function(e,n){return o.post("/api/users",{user:e,response:n}).then(function(e){console.log(e.data.token)})},logIn:function(e){return o.post("/api/users/login",e).then(function(e){n(e.data.token).then(function(e){e&&(document.getElementById("nightmode").checked=c().nightmode,c().nightmode?(document.getElementsByClassName("globalBackground")[0].style.backgroundColor="black",document.getElementsByClassName("globalBackground")[1].style.backgroundColor="black"):(document.documentElement.style.backgroundColor="lightgrey",document.body.style.backgroundColor="lightgrey"))})})},logOut:a,isLoggedIn:i,currentUser:c,deleteAccount:function(e){return o.delete("/api/users/"+e,{headers:{Authorization:"Bearer "+u()}}).then(function(e){a()})},updateSettings:function(e,n){return o.put("/api/users/"+e+"/saveSettings",n,{headers:{Authorization:"Bearer "+u()}})}}}e.$inject=["$window","$http"],angular.module("payupApp").service("authentication",e)}();